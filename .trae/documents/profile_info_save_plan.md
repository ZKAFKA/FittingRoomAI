# 个人信息页面延迟保存功能实现计划

## 功能需求
- 进入个人信息页面时，个人信息的变动不会在修改当时立即同步数据库
- 而是在退出个人信息页面时，与原个人信息数据进行比较
- 如果有差异，则按照当前修改后的数据上传数据库，实现保存
- 如果无差异，则无需上传

## 当前代码分析
- 页面加载和显示时会加载用户信息，设置到 `userInfo` 和 `initialUserInfo`
- 页面卸载时会检查是否有修改，如果有则保存
- 但是 `saveEdit` 函数会在编辑完成时立即保存，这不符合要求
- 输入处理函数会实时更新 `userInfo` 数据

## 任务分解和优先级

### [x] 任务1：修改 saveEdit 函数，移除立即保存逻辑
- **Priority**: P0
- **Depends On**: None
- **Description**:
  - 修改 `saveEdit` 函数，移除其中的保存逻辑，只负责退出编辑状态
  - 确保编辑完成时不会立即触发数据库保存
- **Success Criteria**:
  - `saveEdit` 函数只负责退出编辑状态，不触发数据库保存
  - 编辑完成时页面不会显示保存中提示
- **Test Requirements**:
  - `programmatic` TR-1.1: 编辑完成后检查控制台日志，确认没有触发保存操作
  - `human-judgement` TR-1.2: 编辑完成时不会显示保存中提示，界面响应流畅
- **Notes**: 保留 `hasUserInfoChanged` 函数的调用，用于后续页面卸载时的检查

### [x] 任务2：检查并修改其他可能触发保存的函数
- **Priority**: P1
- **Depends On**: 任务1
- **Description**:
  - 检查 `handleBlur`、`handleKeydown` 等函数，确保它们不会立即触发保存
  - 确保所有编辑操作只修改本地数据，不触发数据库保存
- **Success Criteria**:
  - 所有编辑相关函数只修改本地数据，不触发数据库保存
  - 只有页面卸载时才会触发保存操作
- **Test Requirements**:
  - `programmatic` TR-2.1: 测试各种编辑操作，检查控制台日志，确认没有触发保存操作
  - `human-judgement` TR-2.2: 编辑过程中界面响应流畅，没有卡顿
- **Notes**: 重点检查 `handleBlur` 函数，因为它会在输入框失去焦点时触发

### [x] 任务3：验证页面卸载时的保存逻辑
- **Priority**: P0
- **Depends On**: 任务1, 任务2
- **Description**:
  - 验证 `onUnload` 函数的保存逻辑是否正确
  - 确保页面卸载时会比较数据差异，有差异才保存
  - 确保无差异时不会触发保存操作
- **Success Criteria**:
  - 页面卸载时会比较数据差异，有差异才保存
  - 无差异时不会触发保存操作
- **Test Requirements**:
  - `programmatic` TR-3.1: 修改数据后退出页面，检查控制台日志，确认触发保存操作
  - `programmatic` TR-3.2: 不修改数据直接退出页面，检查控制台日志，确认没有触发保存操作
  - `human-judgement` TR-3.3: 退出页面时保存操作执行流畅，没有明显延迟
- **Notes**: 可以通过控制台日志和网络请求监控来验证保存操作是否触发

### [x] 任务4：测试完整的编辑和保存流程
- **Priority**: P1
- **Depends On**: 任务1, 任务2, 任务3
- **Description**:
  - 测试完整的编辑和保存流程
  - 包括用户名、身高、体重等字段的编辑
  - 验证数据修改后退出页面会保存，未修改则不保存
- **Success Criteria**:
  - 所有字段的编辑都能正常进行
  - 修改数据后退出页面会保存到数据库
  - 未修改数据退出页面不会触发保存操作
- **Test Requirements**:
  - `programmatic` TR-4.1: 编辑用户名后退出页面，检查数据库是否更新
  - `programmatic` TR-4.2: 编辑身高后退出页面，检查数据库是否更新
  - `programmatic` TR-4.3: 编辑体重后退出页面，检查数据库是否更新
  - `programmatic` TR-4.4: 不修改任何数据退出页面，检查数据库是否保持不变
- **Notes**: 可以通过查看数据库中的数据来验证保存操作是否成功

## 技术实现要点
1. **本地数据管理**：编辑操作只修改本地 `userInfo` 数据，不触发保存
2. **数据比较**：使用现有的 `hasUserInfoChanged` 函数比较数据差异
3. **延迟保存**：只在页面卸载时触发保存操作
4. **性能优化**：无差异时不触发保存操作，减少网络请求

## 风险和注意事项
1. **数据丢失**：确保页面卸载时的保存操作能够可靠执行
2. **用户体验**：确保编辑过程中界面响应流畅，不出现卡顿
3. **网络异常**：考虑网络异常时的处理逻辑，确保数据不会丢失
4. **数据一致性**：确保 `initialUserInfo` 数据的准确性，避免误判数据差异

## 预期结果
- 用户可以正常编辑个人信息，编辑过程中界面响应流畅
- 编辑完成后退出页面，系统会自动比较数据差异并保存
- 未修改数据退出页面时，不会触发不必要的网络请求
- 数据保存操作可靠执行，确保用户修改不会丢失