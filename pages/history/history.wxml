<view class="page">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-content">
      <view class="header-top">
        <view class="header-left">
          <text class="page-title">{{langData.history.title || 'è¯•è¡£è®°å½•'}}</text>
        </view>
      </view>
      
      <!-- æœç´¢æ å’ŒæŒ‰é’®è¡Œ -->
      <view class="search-bar-row">
        <!-- æœç´¢æ  -->
        <view class="search-bar {{showSearch ? 'show' : ''}}">
          <view class="search-input-wrap">
            <image class="search-icon" src="/assets/icons/search.png"></image>
            <input 
              class="search-input" 
              placeholder="{{langData.history.search || 'æœç´¢è®°å½•...'}}" 
              placeholder-class="search-placeholder"
              value="{{searchKeyword}}"
              bindinput="onSearchInput"
              confirm-type="search"
              bindconfirm="doSearch"
            />
            <text class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
          </view>
        </view>
        
        <!-- æŒ‰é’®ç»„ -->
        <view class="button-group">
          <view class="filter-btn {{filterOptions.dateRange !== 'all' ? 'active' : ''}}" bindtap="toggleFilterModal">
            <image class="menu-btn-icon" src="/assets/icons/filter.png"></image>
          </view>
          <view class="favorate-btn {{filterOptions.favorite ? 'active' : ''}}" bindtap="toggleFavoriteList">
            <image class="menu-btn-icon" src="{{filterOptions.favorite ? '/assets/icons/favorate-active.png' : '/assets/icons/favorate.png'}}"></image>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å‘¼å¸å…‰ç‰¹æ•ˆ -->
    <view class="header-glow"></view>
  </view>
  
  <!-- ç­›é€‰å¼¹çª— -->
  <view class="modal-overlay {{showFilterModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{langData.history.filterTitle || 'ç­›é€‰è®°å½•'}}</text>
      </view>
      <view class="modal-body">
        <view class="filter-option" bindtap="selectDateRange" data-range="all">
          <text class="option-text">{{langData.history.all || 'å…¨éƒ¨'}}</text>
          <view class="option-radio {{filterOptions.dateRange === 'all' ? 'active' : ''}}"></view>
        </view>
        <view class="filter-option" bindtap="selectDateRange" data-range="today">
          <text class="option-text">{{langData.history.today || 'ä»Šå¤©'}}</text>
          <view class="option-radio {{filterOptions.dateRange === 'today' ? 'active' : ''}}"></view>
        </view>
        <view class="filter-option" bindtap="selectDateRange" data-range="7days">
          <text class="option-text">{{langData.history.sevenDays || '7å¤©å†…'}}</text>
          <view class="option-radio {{filterOptions.dateRange === '7days' ? 'active' : ''}}"></view>
        </view>
        <view class="filter-option" bindtap="selectDateRange" data-range="30days">
          <text class="option-text">{{langData.history.oneMonth || 'ä¸€ä¸ªæœˆå†…'}}</text>
          <view class="option-radio {{filterOptions.dateRange === '30days' ? 'active' : ''}}"></view>
        </view>
        <view class="filter-option" bindtap="selectDateRange" data-range="180days">
          <text class="option-text">{{langData.history.halfYear || 'åŠå¹´å†…'}}</text>
          <view class="option-radio {{filterOptions.dateRange === '180days' ? 'active' : ''}}"></view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="btn-cancel" bindtap="hideFilterModal">{{langData.common.cancel || 'å–æ¶ˆ'}}</view>
        <view class="btn-confirm" bindtap="confirmFilter">{{langData.common.confirm || 'ç¡®è®¤'}}</view>
      </view>
    </view>
  </view>

  <!-- è¯•è¡£è®°å½•ç½‘æ ¼ -->
  <view class="clothes-grid">
    <view 
      class="cloth-card" 
      wx:for="{{fittingHistory.thisWeek}}" 
      wx:key="id" 
      bindtap="handleCardTap"
      data-id="{{item.id}}"
    >
      <image class="cloth-image" src="{{item.imageUrl}}" mode="aspectFill" bindtap="previewImage" data-image-url="{{item.imageUrl}}" lazy-load="true" />
      <view class="cloth-info">
        <text class="cloth-category">{{langData.history.tryonRecord || 'è¯•è¡£è®°å½•'}}</text>
        <text class="cloth-name">{{item.date}}</text>
      </view>
      <view class="cloth-delete" catchtap="handleFavoriteTap" data-id="{{item.id}}" data-section="thisWeek">
        <image class="favorite-icon" src="{{item.isFavorite ? '/assets/icons/heart-filled.png' : '/assets/icons/heart-outline.png'}}"></image>
      </view>
    </view>
    
    <view 
      class="cloth-card" 
      wx:for="{{fittingHistory.lastMonth}}" 
      wx:key="id" 
      bindtap="handleCardTap"
      data-id="{{item.id}}"
    >
      <image class="cloth-image" src="{{item.imageUrl}}" mode="aspectFill" bindtap="previewImage" data-image-url="{{item.imageUrl}}" lazy-load="true" />
      <view class="cloth-info">
        <text class="cloth-category">{{langData.history.tryonRecord || 'è¯•è¡£è®°å½•'}}</text>
        <text class="cloth-name">{{item.date}}</text>
      </view>
      <view class="cloth-delete" catchtap="handleFavoriteTap" data-id="{{item.id}}" data-section="lastMonth">
        <image class="favorite-icon" src="{{item.isFavorite ? '/assets/icons/heart-filled.png' : '/assets/icons/heart-outline.png'}}"></image>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{fittingHistory.thisWeek.length === 0 && fittingHistory.lastMonth.length === 0}}">
    <text class="empty-icon">ğŸ“¸</text>
    <text class="empty-text">{{langData.history.noRecords || 'æ— è¯•è¡£è®°å½•'}}</text>
    <text class="empty-hint">{{langData.history.startTryonHint || 'ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å¼€å§‹è¯•è¡£'}}</text>
  </view>



  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab-container" bindtap="handleFabTap">
    <view class="fab-btn">
      <view class="fab-glow"></view>
      <image class="fab-icon" src="/assets/icons/plus.png"></image>
    </view>
  </view>
</view>
