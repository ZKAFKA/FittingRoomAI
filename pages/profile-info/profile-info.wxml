<view class="page" bindtap="handleOutsideClick">

  <!-- 信息列表 -->
  <view class="info-list">
    <!-- 头像 -->
    <view class="info-item" catchtap="showAvatarNotSupported">
      <text class="info-label">{{langData.profile.avatar || '头像'}}</text>
      <view class="info-value">
        <image class="avatar" src="{{userInfo.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
      </view>
    </view>

    <!-- 用户名 -->
    <view class="info-item" catchtap="showNicknameNotSupported">
      <text class="info-label">{{langData.profile.userName || '用户名'}}</text>
      <view class="info-value">
        <view class="display-text">
          <text>{{userInfo.nickName || (langData.profile.enterUserName || '微信用户')}}</text>
        </view>
      </view>
    </view>

    <!-- 性别 -->
    <view class="info-item">
      <text class="info-label">{{langData.profile.gender || '性别'}}</text>
      <view class="info-value">
        <text class="info-text" catchtap="showGenderPicker">{{userInfo.gender === 'Male' ? '男' : userInfo.gender === 'Female' ? '女' : langData.profile.selectGender || '未设置'}}</text>
      </view>
    </view>

    <!-- 身高 -->
    <view class="info-item">
      <text class="info-label">{{langData.profile.height || '身高'}}</text>
      <view class="info-value">
        <view wx:if="{{!editStates.height}}" class="display-text" catchtap="enterEditState" data-field="height">
          <text>{{userInfo.height || (langData.profile.enterHeight || '请输入身高')}}</text>
        </view>
        <input 
          wx:else 
          class="info-input edit-mode" 
          value="{{userInfo.height}}" 
          bindinput="onHeightChange" 
          placeholder="{{langData.profile.enterHeight || '请输入身高'}}"
          placeholder-class="info-input-placeholder"
          type="number"
          data-field="height"
          bindblur="handleBlur"
          catchtap=""
          focus="{{true}}"
        />
        <text class="info-unit" wx:if="{{!editStates.height}}">cm</text>
      </view>
    </view>

    <!-- 体重 -->
    <view class="info-item">
      <text class="info-label">{{langData.profile.weight || '体重'}}</text>
      <view class="info-value">
        <view wx:if="{{!editStates.weight}}" class="display-text" catchtap="enterEditState" data-field="weight">
          <text>{{userInfo.weight || (langData.profile.enterWeight || '请输入体重')}}</text>
        </view>
        <input 
          wx:else 
          class="info-input edit-mode" 
          value="{{userInfo.weight}}" 
          bindinput="onWeightChange" 
          placeholder="{{langData.profile.enterWeight || '请输入体重'}}"
          placeholder-class="info-input-placeholder"
          type="number"
          data-field="weight"
          bindblur="handleBlur"
          catchtap=""
          focus="{{true}}"
        />
        <text class="info-unit" wx:if="{{!editStates.weight}}">kg</text>
      </view>
    </view>
  </view>

  <!-- 性别选择弹窗 -->
  <view class="modal-overlay {{showGenderModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{langData.profile.gender || '性别'}}</text>
        <view class="modal-close" bindtap="hideGenderModal">✕</view>
      </view>
      <view class="modal-body">
        <view class="gender-option" bindtap="selectGender" data-gender="Male">
          <text class="gender-text">男</text>
          <view class="gender-check {{userInfo.gender === 'Male' ? 'active' : ''}}">
            <image src="/assets/icons/checkmark.png" mode="aspectFit"></image>
          </view>
        </view>
        <view class="gender-option" bindtap="selectGender" data-gender="Female">
          <text class="gender-text">女</text>
          <view class="gender-check {{userInfo.gender === 'Female' ? 'active' : ''}}">
            <image src="/assets/icons/checkmark.png" mode="aspectFit"></image>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="btn-cancel" bindtap="hideGenderModal">{{langData.common.cancel || '取消'}}</view>
        <view class="btn-confirm" bindtap="confirmGender">{{langData.common.confirm || '确定'}}</view>
      </view>
    </view>
  </view>

  <!-- 提示弹窗 -->
  <view class="toast" wx:if="{{showToast}}">
    <text class="toast-text">{{toastMessage}}</text>
  </view>

  <!-- 注销账户链接 -->
  <view class="logout-container">
    <text class="logout-link" bindtap="showLogoutConfirm">注销账户</text>
  </view>

  <!-- 注销确认弹窗 -->
  <view class="modal-overlay {{showLogoutModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">确认注销账户</text>
        <view class="modal-close" bindtap="hideLogoutModal">✕</view>
      </view>
      <view class="modal-body">
        <text class="logout-warning">您确定要注销当前账户吗？此操作将永久删除您的所有个人数据，包括但不限于个人信息、历史记录和偏好设置，且操作不可恢复。</text>
      </view>
      <view class="modal-footer">
        <view class="btn-cancel" bindtap="hideLogoutModal">取消</view>
        <view class="btn-danger" bindtap="confirmLogout">确认注销</view>
      </view>
    </view>
  </view>
</view>
