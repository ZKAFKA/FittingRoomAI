<view class="page">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-content">
      <view class="header-top">
        <view class="header-left">
          <text class="page-title">{{langData.wardrobe.title || 'æˆ‘çš„è¡£æ©±'}}</text>
        </view>
        <view class="header-right">
          <view class="header-btn" bindtap="toggleSearch">
            <image class="btn-icon" src="/assets/icons/search.png"></image>
          </view>
        </view>
      </view>
      
      <!-- æœç´¢æ  -->
      <view class="search-bar {{showSearch ? 'show' : ''}}">
        <view class="search-input-wrap">
          <image class="search-icon" src="/assets/icons/search.png"></image>
          <input 
            class="search-input" 
            placeholder="{{langData.wardrobe.search || 'æœç´¢æ ‡ç­¾...'}}" 
            placeholder-class="search-placeholder"
            value="{{searchKeyword}}"
            bindinput="onSearchInput"
            confirm-type="search"
            bindconfirm="doSearch"
          />
          <text class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
        </view>
      </view>
      
      <!-- åˆ†ç±»æ ‡ç­¾ -->
      <scroll-view class="category-scroll" scroll-x enable-flex>
        <view 
          class="category-chip {{selectedCategory === 'all' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="all"
        >
          {{langData.wardrobe.all || 'å…¨éƒ¨'}} ({{clothesCount.all || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'upper' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="upper"
        >
          {{langData.wardrobe.upper || 'ä¸Šè£…'}} ({{clothesCount.upper || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'lower' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="lower"
        >
          {{langData.wardrobe.lower || 'ä¸‹è£…'}} ({{clothesCount.lower || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'suit' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="suit"
        >
          {{langData.wardrobe.suit || 'å¥—è£…'}} ({{clothesCount.suit || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'shoes' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="shoes"
        >
          {{langData.wardrobe.shoes || 'é‹å¸½'}} ({{clothesCount.shoes || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'accessories' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="accessories"
        >
          {{langData.wardrobe.accessories || 'é¥°å“'}} ({{clothesCount.accessories || 0}})
        </view>
      </scroll-view>
    </view>
    
    <!-- å‘¼å¸å…‰ç‰¹æ•ˆ -->
    <view class="header-glow"></view>
  </view>

  <!-- æœè£…ç½‘æ ¼ -->
  <view class="clothes-grid">
    <view 
      class="cloth-card" 
      wx:for="{{filteredClothes}}" 
      wx:key="_id" 
      bindtap="navigateToClothDetail"
      data-id="{{item._id}}"
    >
      <image class="cloth-image" src="{{item.imageUrl}}" mode="aspectFill" />
      <view class="cloth-info">
        <text class="cloth-category">{{item.categoryName || 'æœè£…'}}</text>
        <text class="cloth-name">{{item.name || 'æœªå‘½å'}}</text>
      </view>
      <view class="cloth-delete" catchtap="deleteCloth" data-id="{{item._id}}">
        <text class="delete-icon">ğŸ—‘ï¸</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredClothes.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ‘•</text>
    <text class="empty-text">{{langData.wardrobe.noClothes || 'ç©ºç©ºå¦‚ä¹Ÿ'}}</text>
    <text class="empty-hint">{{langData.wardrobe.emptyHint || 'ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ è¡£ç‰©'}}</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{langData.common.loading || 'åŠ è½½ä¸­...'}}</text>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab-container" bindtap="showAddModal">
    <view class="fab-btn">
      <view class="fab-glow"></view>
      <image class="fab-icon" src="/assets/icons/plus.png"></image>
    </view>
  </view>

  <!-- æ·»åŠ è¡£ç‰©å¼¹çª— -->
  <view class="modal-overlay {{showAddClothModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-backdrop" bindtap="hideAddModal"></view>
    <view class="modal-glow"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{langData.wardrobe.addCloth || 'æ–°å¢è¡£ç‰©'}}</text>
      </view>

      <view class="modal-body">
        <!-- ä¸Šä¼ ç…§ç‰‡åŒºåŸŸ -->
        <view class="upload-section">
          <view class="upload-area" bindtap="chooseImage" wx:if="{{!newClothImage}}">
            <text class="upload-icon">ğŸ“·</text>
            <text class="upload-text">{{langData.wardrobe.uploadPhoto || 'ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡'}}</text>
          </view>
          <view class="preview-area" wx:else style="{{previewAreaStyle}}">
            <image class="preview-image" src="{{newClothImage}}" mode="aspectFit" />
            <view class="preview-change" bindtap="chooseImage">
              <image class="change-icon" src="/assets/icons/reupload.png" mode="aspectFit" />
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©ç±»å‹ -->
        <view class="form-group">
          <text class="form-label">{{langData.wardrobe.clothCategory || 'è¡£ç‰©ç±»å‹'}}</text>
          <view class="type-selector">
            <view 
              class="type-option {{newClothCategory === 'upper' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="upper"
            >{{langData.wardrobe.upper || 'ä¸Šè£…'}}</view>
            <view 
              class="type-option {{newClothCategory === 'lower' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="lower"
            >{{langData.wardrobe.lower || 'ä¸‹è£…'}}</view>
            <view 
              class="type-option {{newClothCategory === 'suit' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="suit"
            >{{langData.wardrobe.suit || 'å¥—è£…'}}</view>
            <view 
              class="type-option {{newClothCategory === 'shoes' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="shoes"
            >{{langData.wardrobe.shoes || 'é‹å¸½'}}</view>
            <view 
              class="type-option {{newClothCategory === 'accessories' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="accessories"
            >{{langData.wardrobe.accessories || 'é¥°å“'}}</view>
          </view>
        </view>

        <!-- æ·»åŠ æ ‡ç­¾ -->
        <view class="form-group">
          <text class="form-label">{{langData.wardrobe.clothTags || 'æ·»åŠ æ ‡ç­¾'}}</text>
          <view class="tag-input-wrap">
            <input 
              class="tag-input" 
              placeholder="{{langData.wardrobe.tagHint || 'ä¸ºè¯¥ä»¶è¡£ç‰©æ ‡æ³¨ï¼Œé»˜è®¤ä¸ºç©º'}}" 
              placeholder-class="tag-placeholder"
              value="{{newClothTags}}"
              bindinput="onTagInput"
            />
          </view>
          <view class="tag-preview" wx:if="{{tagList.length > 0}}">
            <view class="tag-item" wx:for="{{tagList}}" wx:key="index">
              <text class="tag-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- AI å¤„ç†çŠ¶æ€ -->
        <view class="ai-processing" wx:if="{{aiProcessing}}">
          <view class="loading-spinner"></view>
          <text class="processing-text">{{langData.wardrobe.processing || 'AI æ­£åœ¨å¤„ç†... ç§»é™¤èƒŒæ™¯ä¸­'}}</text>
        </view>
      </view>

      <view class="modal-footer" wx:if="{{!aiProcessed}}">
        <view class="btn-confirm" bindtap="confirmAddCloth">{{langData.wardrobe.confirmUpload || 'ç¡®è®¤ä¸Šä¼ '}}</view>
        <view class="btn-cancel" bindtap="hideAddModal">{{langData.common.cancel || 'å–æ¶ˆ'}}</view>
      </view>
      <view class="modal-footer processed" wx:else>
        <view class="btn-secondary" bindtap="chooseImage">{{langData.wardrobe.reupload || 'é‡æ–°ä¸Šä¼ '}}</view>
        <view class="btn-confirm" bindtap="addToWardrobe">{{langData.wardrobe.addToWardrobe || 'åŠ å…¥è¡£æ©±'}}</view>
      </view>
    </view>
  </view>
</view>
