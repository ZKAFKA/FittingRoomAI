<view class="page">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-content">
      <view class="header-top">
        <view class="header-left">
          <text class="page-title">æˆ‘çš„è¡£æ©±</text>
        </view>
        <view class="header-right">
          <view class="header-btn" bindtap="toggleSearch">
            <image class="btn-icon" src="/assets/icons/search.png"></image>
          </view>
        </view>
      </view>
      
      <!-- æœç´¢æ  -->
      <view class="search-bar {{showSearch ? 'show' : ''}}">
        <view class="search-input-wrap">
          <image class="search-icon" src="/assets/icons/search.png"></image>
          <input 
            class="search-input" 
            placeholder="æœç´¢æ ‡ç­¾..." 
            placeholder-class="search-placeholder"
            value="{{searchKeyword}}"
            bindinput="onSearchInput"
            confirm-type="search"
            bindconfirm="doSearch"
          />
          <text class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
        </view>
      </view>
      
      <!-- åˆ†ç±»æ ‡ç­¾ -->
      <scroll-view class="category-scroll" scroll-x enable-flex>
        <view 
          class="category-chip {{selectedCategory === 'all' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="all"
        >
          All ({{clothesCount.all || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'upper' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="upper"
        >
          Tops ({{clothesCount.upper || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'lower' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="lower"
        >
          Bottoms ({{clothesCount.lower || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'outerwear' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="outerwear"
        >
          Outerwear ({{clothesCount.outerwear || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'shoes' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="shoes"
        >
          Shoes ({{clothesCount.shoes || 0}})
        </view>
        <view 
          class="category-chip {{selectedCategory === 'accessories' ? 'active' : ''}}" 
          bindtap="selectCategory" 
          data-id="accessories"
        >
          Accessories ({{clothesCount.accessories || 0}})
        </view>
      </scroll-view>
    </view>
    
    <!-- å‘¼å¸å…‰ç‰¹æ•ˆ -->
    <view class="header-glow"></view>
  </view>

  <!-- æœè£…ç½‘æ ¼ -->
  <view class="clothes-grid">
    <view 
      class="cloth-card" 
      wx:for="{{filteredClothes}}" 
      wx:key="_id" 
      bindtap="navigateToClothDetail"
      data-id="{{item._id}}"
    >
      <image class="cloth-image" src="{{item.imageUrl}}" mode="aspectFill" />
      <view class="cloth-info">
        <text class="cloth-category">{{item.categoryName || 'æœè£…'}}</text>
        <text class="cloth-name">{{item.name || 'æœªå‘½å'}}</text>
      </view>
      <view class="cloth-delete" catchtap="deleteCloth" data-id="{{item._id}}">
        <text class="delete-icon">ğŸ—‘ï¸</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredClothes.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ‘•</text>
    <text class="empty-text">æš‚æ— æœè£…</text>
    <text class="empty-hint">ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ è¡£ç‰©</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab-container" bindtap="showAddModal">
    <view class="fab-btn">
      <view class="fab-glow"></view>
      <image class="fab-icon" src="/assets/icons/plus.png"></image>
    </view>
  </view>

  <!-- æ·»åŠ è¡£ç‰©å¼¹çª— -->
  <view class="modal-overlay {{showAddClothModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-backdrop" bindtap="hideAddModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ è¡£ç‰©</text>
        <text class="modal-subtitle">ä¸Šä¼ ç…§ç‰‡å¹¶æ·»åŠ æ ‡ç­¾</text>
      </view>

      <view class="modal-body">
        <!-- ä¸Šä¼ ç…§ç‰‡åŒºåŸŸ -->
        <view class="upload-section">
          <view class="upload-area" bindtap="chooseImage" wx:if="{{!newClothImage}}">
            <text class="upload-icon">ğŸ“·</text>
            <text class="upload-text">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</text>
          </view>
          <view class="preview-area" wx:else>
            <image class="preview-image" src="{{newClothImage}}" mode="aspectFill" />
            <view class="preview-change" bindtap="chooseImage">
              <text class="change-icon">ğŸ”„</text>
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©ç±»å‹ -->
        <view class="form-group">
          <text class="form-label">è¡£ç‰©ç±»å‹</text>
          <view class="type-selector">
            <view 
              class="type-option {{newClothCategory === 'upper' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="upper"
            >ä¸Šè£…</view>
            <view 
              class="type-option {{newClothCategory === 'inner' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="inner"
            >å†…æ­</view>
            <view 
              class="type-option {{newClothCategory === 'lower' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="lower"
            >ä¸‹è£…</view>
            <view 
              class="type-option {{newClothCategory === 'suit' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="suit"
            >å¥—è£…</view>
            <view 
              class="type-option {{newClothCategory === 'shoes' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="shoes"
            >é‹å¸½</view>
            <view 
              class="type-option {{newClothCategory === 'accessories' ? 'active' : ''}}" 
              bindtap="selectNewCategory" 
              data-category="accessories"
            >é…é¥°</view>
          </view>
        </view>

        <!-- æ·»åŠ æ ‡ç­¾ -->
        <view class="form-group">
          <text class="form-label">æ·»åŠ æ ‡ç­¾</text>
          <view class="tag-input-wrap">
            <input 
              class="tag-input" 
              placeholder="è¾“å…¥æ ‡ç­¾ï¼Œç”¨ç©ºæ ¼åˆ†éš”" 
              placeholder-class="tag-placeholder"
              value="{{newClothTags}}"
              bindinput="onTagInput"
            />
          </view>
          <view class="tag-preview" wx:if="{{tagList.length > 0}}">
            <view class="tag-item" wx:for="{{tagList}}" wx:key="index">
              <text class="tag-text">{{item}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <view class="btn-confirm" bindtap="confirmAddCloth">ç¡®è®¤æ·»åŠ </view>
        <view class="btn-cancel" bindtap="hideAddModal">å–æ¶ˆ</view>
      </view>
    </view>
  </view>
</view>
