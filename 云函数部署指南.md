# 云函数部署指南

## 问题分析

您遇到的错误：
```
FunctionName parameter could not be found
```

**原因**：login云函数只创建了本地文件，但没有部署到云端，导致小程序无法找到该云函数。

## 解决方案

### 步骤1：在微信开发者工具中部署云函数

1. **打开项目**
   - 打开微信开发者工具
   - 导入项目：`c:\Users\ZKAFKA\Desktop\FittingRoomAI+`
   - 确保云开发环境已开通

2. **部署login云函数**
   - 在左侧目录树中找到 `cloudfunctions/login` 文件夹
   - 右键点击 `login` 文件夹
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待部署完成（约1-2分钟）
   - 部署成功后会显示"上传成功"

3. **部署其他云函数**
   - 同样的方式部署以下云函数：
     - `cloudfunctions/generateImage-wndKh7`
     - `cloudfunctions/initInspirations`
     - `cloudfunctions/initWardrobe`
     - `cloudfunctions/cleanDatabase`
     - `cloudfunctions/backupDatabase`
     - `cloudfunctions/restoreDatabase`

### 步骤2：验证云函数部署

1. **检查云函数状态**
   - 在微信开发者工具中，点击顶部菜单"云开发"
   - 点击"云函数"
   - 确认所有云函数都显示在列表中
   - 状态应该是"已部署"

2. **测试login云函数**
   - 找到 `login` 云函数
   - 点击"测试"按钮
   - 点击"调用"按钮
   - 查看返回结果：
     ```json
     {
       "success": true,
       "openid": "oxxxxx",
       "sessionKey": "xxxxx"
     }
     ```

### 步骤3：重新测试小程序

1. **编译小程序**
   - 点击微信开发者工具中的"编译"按钮
   - 观察控制台输出

2. **验证登录**
   - 在模拟器中打开小程序
   - 检查控制台是否还有登录失败的错误
   - 确认用户信息是否正常加载

## 常见问题

### Q1：部署云函数时提示"无权限"
**A**：检查您的微信账号是否有权限操作云开发环境。

### Q2：部署云函数时提示"依赖安装失败"
**A**：检查网络连接，确保能正常访问npm源。

### Q3：云函数部署成功但仍然报错
**A**：
1. 检查云函数名称是否正确
2. 检查环境ID是否正确
3. 尝试重新部署云函数

### Q4：如何查看云函数日志
**A**：
1. 在云开发控制台中找到云函数
2. 点击"日志"标签
3. 查看实时日志和历史日志

## 环境配置检查

### 1. 确认环境ID
打开 `app.js` 文件，确认环境ID正确：
```javascript
wx.cloud.init({
  env: 'fittingroom-0g0zcm3w1d2f40c5', // 确保此环境ID正确
  traceUser: true
});
```

### 2. 确认云函数配置
打开 `project.config.json` 文件，确认云函数根目录配置正确：
```json
"cloudfunctionRoot": "cloudfunctions/",
```

## 预期结果

部署完成后，小程序应该能够正常登录，控制台不再显示错误信息，并且能够成功获取用户信息。

## 后续操作

1. **初始化官方灵感数据**
   - 部署 `initInspirations` 云函数
   - 调用该云函数初始化官方灵感库

2. **初始化测试服装数据**（可选）
   - 部署 `initWardrobe` 云函数
   - 调用该云函数初始化测试服装数据

3. **配置HunyuanImage API**
   - 部署 `generateImage-wndKh7` 云函数
   - 配置HunyuanImage API密钥

## 技术支持

如果仍然遇到问题，请：
1. 检查网络连接
2. 确认云开发环境状态
3. 重新部署所有云函数
4. 查看云开发控制台的错误日志